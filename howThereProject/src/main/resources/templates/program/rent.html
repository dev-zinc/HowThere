<!doctype html>
<html lang="en" xmlns="" xmlns:th="http://www.thymeleag.org">

<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
		name="viewport">
	<meta content="ie=edge" http-equiv="X-UA-Compatible">
	<title>렌트카 신청</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/layout/index.css" rel="stylesheet">
	<link href="/css/program/rent.css" rel="stylesheet">
	<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
	<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>


<!--	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">-->
<!--	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>-->
<!--	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script></head>-->

<body>
	<div th:replace="~{/layout/header :: header}"></div>
	<main>
		<div class="main-container">
			<div style="padding-left: 80px; padding-right: 80px;">
				<div style="margin-left: auto; margin-right: auto; max-width: 1120px;">
					<div class="car-container">
						<div id="indicativeDeals">
							<h2 class="header">렌터카 찾기</h2>
							<select name="" id="area-select">
								<option value="all">지역</option>
								<option value="강원">강원</option>
								<option value="경기">경기</option>
								<option value="경남">경남</option>
								<option value="경북">경북</option>
								<option value="광주">광주</option>
								<option value="대구">대구</option>
								<option value="대전">대전</option>
								<option value="부산">부산</option>
								<option value="세종">세종</option>
								<option value="울산">울산</option>
								<option value="인천">인천</option>
								<option value="전남">전남</option>
								<option value="전북">전북</option>
								<option value="제주">제주</option>
								<option value="충남">충남</option>
								<option value="충북</">충북</option>
							</select>
							<select name="" id="car-select">
								<option value="차량 종류">차량 종류</option>
								<option value="LiteCar">경차</option>
								<option value="CompactCar">소형차</option>
								<option value="mediumSizedCar">중형차</option>
								<option value="LargeCar">대형차</option>
								<option value="SUV">SUV</option>
							</select>
						</div>


					<div class="deals-list"  id="deals-list">

					</div>



						<div class="d-flex justify-content-end">
							<button style="float: right" id="more" class="">더보기</button>
							<button style="float: right" id="more_2" class="d-none">더보기</button>
							<a href="#" id="book_rent" class="btn btn-success"> 예약하기</a>
						</div>

					</div>
					<div class="content-border"></div>
					<div class="car-location">
						<h2>서울에서 최적의 렌터카 지점 찾기</h2>
					</div>
					<div class="map-container" style="margin: 0; padding-bottom: 28px;">
						<div id="map" style="width:1120px;height:400px; margin: auto"></div>
					</div>
					<div class="content-border"></div>
					<div class="route-statistics">
						<h2>서울에서 렌터카 이용하기: 간략한 정보</h2>
						<h3>즐거운 로드트립을 위해 알아두어야 할 모든 것.</h3>
						<table class="snippets">
							<tbody class="rent-tbody">
								<tr>
									<th class="rent-th">
										<span>
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
												class="RouteStatistics_Snippet__iconGray__MDFjO">
												<path
													d="M10.23 4.072a4.771 4.771 0 00-6.62.577 5.514 5.514 0 00-1.39 5.408c.855 3.72 5.28 7.895 8.62 10.537a1.859 1.859 0 002.32 0c3.34-2.642 7.765-6.816 8.62-10.537a5.516 5.516 0 00-1.389-5.408 4.77 4.77 0 00-6.62-.577l-1.126.95a1 1 0 01-1.29 0z">
												</path>
											</svg>
										</span>
										<h3>인기 있는 렌터카 업체</h3>
									</th>
									<td>
										<a class="snippet-link" href="#" rel="nofollow">
											<span>4season car rental</span>
										</a>
									</td>
								</tr>
								<tr>
									<th>
										<span>
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
												class="RouteStatistics_Snippet__iconGray__MDFjO">
												<path
													d="M7.443 11.896V20a1 1 0 001 1h6.035a5 5 0 004.682-3.244l2.27-6.054A2 2 0 0019.557 9h-4.833a1 1 0 01-.97-1.243l.297-1.188A2.873 2.873 0 0011.263 3a.479.479 0 00-.443.296l-3.227 7.838a2 2 0 00-.151.762zm-2 .604a1.5 1.5 0 00-3 0v7a1.5 1.5 0 003 0z">
												</path>
											</svg>
										</span>
										<h3>인기 있는 차량</h3>
									</th>
									<td>
										<a class="snippet-link" href="#" rel="nofollow">
											<span>중형차, 승합차</span>
										</a>
									</td>
								</tr>
								<tr>
									<th>
										<span>
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
												class="RouteStatistics_Snippet__iconGray__MDFjO">
												<path
													d="M21 6.908A3.908 3.908 0 0017.092 3H12.62a3 3 0 00-2.12.878l-6.623 6.624a2.997 2.997 0 000 4.238l5.382 5.382a2.997 2.997 0 004.238 0l6.624-6.624A2.996 2.996 0 0021 11.38V6.91zM16.5 9a1.5 1.5 0 110-3 1.5 1.5 0 010 3z">
												</path>
											</svg>
										</span>
										<h3>일 평균 가격</h3>
									</th>
									<td>
										<a class="snippet-link" href="#" rel="nofollow">
											<span>₩294,442</span>
										</a>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</main>
	<div th:replace="~{/layout/footer :: footer}"></div>
</body>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0206a2d2eb084b7e9e5e14b2d869093d" type="text/javascript"></script>

<script>
	const clickEvt = function (event) {

		event.preventDefault(); // 기본 링크 동작을 막음-->

		let {id: rentCarId, latitude, longitude} = event.currentTarget.dataset;

		var mapContainer = document.getElementById('map'), // 지도를 표시할 div
				mapOption = {
					center: new kakao.maps.LatLng(latitude, longitude), // 지도의 중심좌표
					level: 3 // 지도의 확대 레벨
				};

		var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

		// 마커가 표시될 위치입니다
		var markerPosition = new kakao.maps.LatLng(latitude, longitude);

		// 마커를 생성합니다
		var marker = new kakao.maps.Marker({
			position: markerPosition
		});

		// 마커가 지도 위에 표시되도록 설정합니다
		marker.setMap(map);

		// 아래 코드는 지도 위의 마커를 제거하는 코드입니다
		// marker.setMap(null);


		$("#book_rent").click(function () {
			$.ajax({
				url: "/program/rent/reservation",     // 요청할 URL
				method: "GET",        // HTTP 메소드
				data: {"rentCarId": rentCarId},  // 요청 데이터 (선택적)
				success: function (response) {
					// 요청 성공 시 실행되는 함수
					location.href = "http://localhost:10000/program/rent/reservation?rentCarId=" + rentCarId;
				},
				error: function (xhr, status, error) {
					// 요청 실패 시 실행되는 함수
				}
			});
		})



	};
	const container = document.getElementById("deals-list");
	const more = document.getElementById("more");
	let page = 0;

	getList();

	function getList(){
		fetch(`api/rent?page=${page}`)
				.then((response) => response.json())
				.then((products) => {
					let text = ``;
					products.content.forEach(rentCar => {
						text += `
                            <div class="panel">
							<div class="deal-card">
								<div onclick="clickEvt(event)" class="card-item rent-car-link" data-id="${rentCar.id}" data-latitude="${rentCar.rentCarCompanyDTO.rentCarCompanyAddress.latitude}" data-longitude="${rentCar.rentCarCompanyDTO.rentCarCompanyAddress.longitude}">
									<div class="left-section">
										<h3 class="car-model" >${rentCar.rentCarName}</h3>
										<div class="capacity-main">
											<div class="capacity-item">
												<div class="capacity-icon">
													<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg">
														<path d="M10 1.98a.697.697 0 01.382-.667A4.083 4.083 0 0112 1a3.974 3.974 0 011.595.31A.73.73 0 0114 2v2.514C14 5.5 13 6 12 6s-2-.5-2-1.486zm6 12.244V8.302a.84.84 0 00-.548-.823A12.589 12.589 0 0012.035 7a12.671 12.671 0 00-3.488.55.854.854 0 00-.547.83v5.92c0 .402.62.749 1.191.964a1.195 1.195 0 01.805.989l.45 5.823a1 1 0 00.997.923h1.184a1 1 0 00.997-.923l.45-5.823a1.267 1.267 0 01.797-1.014C15.418 15 16 14.624 16 14.224z"></path>
													</svg>
												</div>
												<span class="text" >${rentCar.rentCarCompanyDTO.rentCarCompanyName}</span>
											</div>
										</div>
									</div>
									<div style="display: none"></div>
									<div class="right-section">
										<div class="price-text">
											<span>₩${rentCar.rentCarPrice}</span>부터
										</div>
										<p class="price-text">일일 가격</p>
										<div class="panel-img">
											<div>
												<div>
													<div style="height:0;padding-bottom:66.66666666666667%; background-color: transparent">
<!--														<img class="car-img" alt="미니" src="https://logos.skyscnr.com/images/carhire/seo/deals-images/mini.png">-->
														<img class="car-img" alt="미니" src="${rentCar.rentCarFileDTOS[0].filePath}">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
                            `
					});
					container.innerHTML += text;
					if(products.last){
						more.style.display = "none";
					}
				});
	}

	more.addEventListener("click", function(){
	    page++;
	    getList()
	})

</script>
<script>
	$(document).ready(function() {


		$("#area-select").change(function() {
			let selectedLocal = $(this).val();
			$.ajax({
				url: "/program/api/rent",     // 요청할 URL
				method: "GET",        // HTTP 메소드
				data: {  "selectedLocal": selectedLocal},  // 요청 데이터 (선택적)
				success: function(rentCars) {
					container.innerHTML = ``;

					// $("#more_2").

					let text = ``;
					rentCars.content.forEach(rentCar => {
						text += `
                            <div class="panel">
							<div class="deal-card">
								<div onclick="clickEvt(event)" class="card-item rent-car-link" data-id="${rentCar.id}" data-latitude="${rentCar.rentCarCompanyDTO.rentCarCompanyAddress.latitude}" data-longitude="${rentCar.rentCarCompanyDTO.rentCarCompanyAddress.longitude}">
									<div class="left-section">
										<h3 class="car-model" >${rentCar.rentCarName}</h3>
										<div class="capacity-main">
											<div class="capacity-item">
												<div class="capacity-icon">
													<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg">
														<path d="M10 1.98a.697.697 0 01.382-.667A4.083 4.083 0 0112 1a3.974 3.974 0 011.595.31A.73.73 0 0114 2v2.514C14 5.5 13 6 12 6s-2-.5-2-1.486zm6 12.244V8.302a.84.84 0 00-.548-.823A12.589 12.589 0 0012.035 7a12.671 12.671 0 00-3.488.55.854.854 0 00-.547.83v5.92c0 .402.62.749 1.191.964a1.195 1.195 0 01.805.989l.45 5.823a1 1 0 00.997.923h1.184a1 1 0 00.997-.923l.45-5.823a1.267 1.267 0 01.797-1.014C15.418 15 16 14.624 16 14.224z"></path>
													</svg>
												</div>
												<span class="text" >${rentCar.rentCarCompanyDTO.rentCarCompanyName}</span>
											</div>
										</div>
									</div>
									<div style="display: none"></div>
									<div class="right-section">
										<div class="price-text">
											<span>₩${rentCar.rentCarPrice}</span>부터
										</div>
										<p class="price-text">일일 가격</p>
										<div class="panel-img">
											<div>
												<div>
													<div style="height:0;padding-bottom:66.66666666666667%; background-color: transparent">
<!--														<img class="car-img" alt="미니" src="https://logos.skyscnr.com/images/carhire/seo/deals-images/mini.png">-->
														<img class="car-img" alt="미니" src="${rentCar.rentCarFileDTOS[0].filePath}">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
                            `
					});

					container.innerHTML = text;
				},
				error: function(xhr, status, error) {
					// 요청 실패 시 실행되는 함수
				}
			});
		});


		$("#car-select").change(function() {
			let selectedCar = $(this).val();
			$.ajax({
				url: "/program/api/rent",     // 요청할 URL
				method: "GET",        // HTTP 메소드
				data: {  "selectedCar": selectedCar },  // 요청 데이터 (선택적)
				success: function(rentCars) {
					container.innerHTML = ``;

					let text = ``;
					rentCars.content.forEach(rentCar => {
						text += `
                            <div class="panel">
							<div class="deal-card">
								<div onclick="clickEvt(event)" class="card-item rent-car-link" data-id="${rentCar.id}" data-latitude="${rentCar.rentCarCompanyDTO.rentCarCompanyAddress.latitude}" data-longitude="${rentCar.rentCarCompanyDTO.rentCarCompanyAddress.longitude}">
									<div class="left-section">
										<h3 class="car-model" >${rentCar.rentCarName}</h3>
										<div class="capacity-main">
											<div class="capacity-item">
												<div class="capacity-icon">
													<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg">
														<path d="M10 1.98a.697.697 0 01.382-.667A4.083 4.083 0 0112 1a3.974 3.974 0 011.595.31A.73.73 0 0114 2v2.514C14 5.5 13 6 12 6s-2-.5-2-1.486zm6 12.244V8.302a.84.84 0 00-.548-.823A12.589 12.589 0 0012.035 7a12.671 12.671 0 00-3.488.55.854.854 0 00-.547.83v5.92c0 .402.62.749 1.191.964a1.195 1.195 0 01.805.989l.45 5.823a1 1 0 00.997.923h1.184a1 1 0 00.997-.923l.45-5.823a1.267 1.267 0 01.797-1.014C15.418 15 16 14.624 16 14.224z"></path>
													</svg>
												</div>
												<span class="text" >${rentCar.rentCarCompanyDTO.rentCarCompanyName}</span>
											</div>
										</div>
									</div>
									<div style="display: none"></div>
									<div class="right-section">
										<div class="price-text">
											<span>₩${rentCar.rentCarPrice}</span>부터
										</div>
										<p class="price-text">일일 가격</p>
										<div class="panel-img">
											<div>
												<div>
													<div style="height:0;padding-bottom:66.66666666666667%; background-color: transparent">
<!--														<img class="car-img" alt="미니" src="https://logos.skyscnr.com/images/carhire/seo/deals-images/mini.png">-->
														<img class="car-img" alt="미니" src="${rentCar.rentCarFileDTOS[0].filePath}">
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
                            `
					});

					container.innerHTML = text;
				},
				error: function(xhr, status, error) {
					// 요청 실패 시 실행되는 함수
				}
			});

		});
	})

</script>
<script th:inline="javascript">
	var rentCars  = [[${rentCars}]];
</script>

</html>