<!doctype html>
<html lang="en" xmlns="" xmlns:th="http://www.thymeleag.org">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
		  name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
		  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" rel="stylesheet">
    <link href="/css/layout/index.css" rel="stylesheet">
    <link href="/css/program/rent-reservation.css" rel="stylesheet">
    <link href="/css/program/datePicker.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <title>프로그램 상세</title>
</head>

<body>
    <div th:replace="~{/layout/header :: header}"></div>
    <main>
        <div id="content-box">
            <div class="content" id="content-box-main">
                <section class="left-section" id="program-main-container">
                    <div class="content-wrap">
                        <div class="program-grid">
                            <div>
                                <div class="program-title">
                                    <div data-reactroot="" style="--gp-section-max-width:1120px">
                                        <div>
                                            <div class="title-box">
                                                <div style="padding-top:24px">
                                                    <section>
                                                        <div style="margin-bottom: 4px;">
                                                            <span style="font-size: 26px; line-height:30px;font-weight:  600;">
                                                                <h1 style="color: inherit;font-size: 1em;font-weight: inherit;line-height: inherit;"th:text="${rentCar.rentCarName}">
                                                                    미니 (차이름 넣으면 될 것 같아여)</h1>
																<b id="drivingCharge">주행요금 220 ~ 250원/km</b>
                                                            </span>
                                                        </div>
                                                        <div>
															<div class="carousel slide" data-bs-ride="carousel" id="carouselIndicators">
																<div class="carousel-indicators">
																	<button aria-label="Slide 1" class="" data-bs-slide-to="0" data-bs-target="#carouselIndicators" type="button"></button>
																	<button aria-label="Slide 2" class="" data-bs-slide-to="1" data-bs-target="#carouselIndicators" type="button"></button>
																	<button aria-current="true" aria-label="Slide 3" class="active" data-bs-slide-to="2" data-bs-target="#carouselIndicators" type="button"></button>
																</div>

																<div class="carousel-inner" >
                                                                    <th:block th:each="file, i : ${rentCar.rentCarFileDTOS}" >
                                                                        <div th:class="|carousel-item ${i.index==0?'active':''}|">
                                                                            <img alt="미니" class="car-img" th:src="${file.filePath}">
                                                                        </div>
                                                                    </th:block>
<!--																	<div class="carousel-item">-->
<!--																		<img alt="경차" class="car-img" src="https://logos.skyscnr.com/images/carhire/seo/deals-images/economy.png">-->
<!--																	</div>-->
<!--																	<div class="carousel-item active">-->
<!--																		<img alt="미니" class="car-img" src="https://logos.skyscnr.com/images/carhire/seo/deals-images/mini.png">-->
<!--																	</div>-->
																</div>
																<button class="carousel-control-prev" data-bs-slide="prev" data-bs-target="#carouselIndicators" type="button">
																	<span aria-hidden="true" class="carousel-control-prev-icon"></span>
																	<span class="visually-hidden">Previous</span>
																</button>
																<button class="carousel-control-next" data-bs-slide="next" data-bs-target="#carouselIndicators" type="button">
																	<span aria-hidden="true" class="carousel-control-next-icon"></span>
																	<span class="visually-hidden">Next</span>
																</button>
															</div>
                                                        </div>
                                                    </section>
                                                </div>
                                            </div>
                                            <div class="content-box">
                                                <div class="subtitle">
                                                    <div>
                                                        <div>
                                                            <div style="flex-grow: 0;flex-shrink: 1;flex-basis: 100%;">
                                                                <div class="car-description">
                                                                    <h2>차량정보</h2>
                                                                </div>
                                                                <ol class="car-info">
                                                                    <li class=""><span>승차정원 4명</span>
                                                                    </li>
                                                                    <li class="">
																		<span aria-hidden="true"> · </span>
                                                                        <span>하이패스 포함</span>
                                                                    </li>
																	<li class="">
																		<span aria-hidden="true"> · </span>
                                                                        <span>소형</span>
                                                                    </li>
																	<li class="">
																		<span aria-hidden="true"> · </span>
                                                                        <span>경유</span>
                                                                    </li>
                                                                </ol>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="content-border">
                                                    </div>
                                                    <div style="padding-top: 32px; padding-bottom: 32px;">
                                                        <div style="display: flex;flex-direction: column;gap: 24px;">
                                                            <div>
                                                                <div class="content info">
                                                                    <div class="icon">
                                                                        <img alt="safety" src="/img/rent/car-insurance.png">
                                                                    </div>
                                                                    <div class="text-box">
                                                                        <div class="title">
                                                                            <b>안전옵션</b>
                                                                        </div>
                                                                        <div class="text">- 에어백</div>
                                                                        <div class="text">- 후방감지센서</div>
                                                                        <div class="text">- 블랙박스</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div class="content info">
                                                                    <div class="icon">
                                                                        <img alt="convenience options" src="/img/rent/car.png">
                                                                    </div>
                                                                    <div class="text-box">
                                                                        <div class="title">
                                                                            <b>편의옵션</b>
                                                                        </div>
																		<div class="text">- 에어컨</div>
                                                                        <div class="text">- 열선시트</div>
                                                                        <div class="text">- AUX/USB</div>
                                                                        <div class="text">- 블루투스</div>
                                                                        <div class="text">- 내비게이션</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
                    </div>
                </section>
				<section class="right-section">
                        <div class="grid">
                            <div class="grid between">
                                <div>대여일</div>
                                <div><input class="search-input " id="startDate" name="startDate" placeholder="날짜 추가" type="text"></div>
                            </div>
                            <div class="grid between">
                                <div>반납일</div>
                                <div><input class="search-input " id="endDate" name="endDate" placeholder="날짜 추가" type="text"></div>
                            </div>
                            <div class="grid between">
                                <div>일일가격</div>
                                <div><h4 th:text="${rentCar.rentCarPrice}"></h4></div>
                            </div>
                        </div>
                        <div class="btn-box flex">
                            <button th:block th:if="!${paymentId}" class="reservation-btn" id="reservation_btn_click"><span>예약하기</span></button>
                            <button th:block th:if="${paymentId}" class="reservation-btn" id="rent_car_payment_id"><span>수정하기</span></button>
                        </div>
				</section>
            </div>
        </div>
        <div style="display: none" id="rent_car_id" th:text="${rentCar.id}"></div>
    </main>
    <div th:replace="~{/layout/footer :: footer}"></div>
</body>
<script th:inline="javascript">
    var rentCars  = [[${rentCar}]];
    console.log(rentCars);
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0206a2d2eb084b7e9e5e14b2d869093d" type="text/javascript"></script>
<script crossorigin="anonymous"
		integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script crossorigin="anonymous"
		integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
<script>
		const dateDepart = $('#startDate');
		const dateReturn = $('#endDate');

		$("#startDate, #endDate").datepicker({
			dateFormat: 'yy-mm-dd',
			prevText: '<',
			nextText: '>',
			monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
			monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
			dayNames: ['일', '월', '화', '수', '목', '금', '토'],
			dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
			dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
			showMonthAfterYear: true,
			yearSuffix: '년',
			minDate: 0
		}).on('change', function () {
			const startDate = dateDepart.val();
			const endDate = dateReturn.val() === "" ? startDate : dateReturn.val();

			if (startDate > endDate)
				dateDepart.val(endDate);
		});
</script>
<script th:inline="javascript">
    $(document).ready(function() {

        $("#reservation_btn_click").on('click', function() {
            let rentCarId = $("#rent_car_id").text();
            let startDate = $("#startDate").val();
            let endDate = $("#endDate").val();

            if(startDate === ""){
                alert("날짜를 선택해주세요");
                return;
            }
            if(endDate === ""){
                alert("날짜를 선택해주세요")
                return;
            }

            console.log("Rent Car Id:", rentCarId);
            console.log("Start Day:", startDate);
            console.log("End Day:", endDate);


            $.ajax({
                url: "/program/rent_reservation",     // 요청할 URL
                method: "POST",        // HTTP 메소드
                data: {
                    "rentCarId": rentCarId,
                    "startDay": startDate,
                    "endDay": endDate
                },  // 요청 데이터 (선택적)
                success: function(response) {
                    console.log(response);  // 서버 응답 데이터
                    // 요청 성공 시 실행되는 함수
                    if(response.response == "success"){
                        alert("예약 되었습니다");
                        location.href = "http://localhost:10000/account/payment";
                    }

                },
                error: function(xhr, status, error) {
                    // 요청 실패 시 실행되는 함수
                    console.error(error);   // 오류 메시지 출력
                }
            });


        });

        $("#btn_click_update").on('click', function() {
            let paymentId =[[${paymentId}]];

            let price = $("#price").text();
            let startDay = $("#startDay").val();
            let endDay = $("#endDay").val();

            console.log(paymentId);
            console.log(price);
            console.log(startDay);
            console.log(endDay);

            $.ajax({
                url: "/program/rent_update",     // 요청할 URL
                method: "POST",        // HTTP 메소드
                data: {
                    "paymentId": paymentId,
                    "price": price,
                    "startDay": startDay,
                    "endDay": endDay
                },  // 요청 데이터 (선택적)
                success: function(response) {
                    console.log(response);  // 서버 응답 데이터
                    // 요청 성공 시 실행되는 함수
                    if(response.response == "success"){
                        alert("예약이 수정 되었습니다.");
                        location.href = "http://localhost:10000/program/rent_payment_detail_test?rentCarPaymentId="+paymentId;
                    }
                },
                error: function(xhr, status, error) {
                    // 요청 실패 시 실행되는 함수
                    console.error(error);   // 오류 메시지 출력
                }
            });


        });



    });
</script>
</html>